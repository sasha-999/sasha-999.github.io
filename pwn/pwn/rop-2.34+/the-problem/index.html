<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-pwn/rop-2.34+/the-problem" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">The problem | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://0xa5h.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://0xa5h.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://0xa5h.com/pwn/pwn/rop-2.34+/the-problem"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="The problem | My Site"><meta data-rh="true" name="description" content="What happened to ROP?"><meta data-rh="true" property="og:description" content="What happened to ROP?"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://0xa5h.com/pwn/pwn/rop-2.34+/the-problem"><link data-rh="true" rel="alternate" href="https://0xa5h.com/pwn/pwn/rop-2.34+/the-problem" hreflang="en"><link data-rh="true" rel="alternate" href="https://0xa5h.com/pwn/pwn/rop-2.34+/the-problem" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"pwn","item":"https://0xa5h.com/pwn/category/pwn"},{"@type":"ListItem","position":2,"name":"ROP 2.34+","item":"https://0xa5h.com/pwn/category/rop-234"},{"@type":"ListItem","position":3,"name":"The problem","item":"https://0xa5h.com/pwn/pwn/rop-2.34+/the-problem"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.875859fc.css">
<script src="/assets/js/runtime~main.f72019f0.js" defer="defer"></script>
<script src="/assets/js/main.aa702dda.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pwn/">Tutorial</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pwn/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/pwn/category/pwn">pwn</a><button aria-label="Collapse sidebar category &#x27;pwn&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/pwn/category/rop-234">ROP 2.34+</a><button aria-label="Collapse sidebar category &#x27;ROP 2.34+&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pwn/pwn/rop-2.34+/the-problem">The problem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pwn/pwn/rop-2.34+/ret2gets">ret2gets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pwn/pwn/rop-2.34+/controlling-rbp">Controlling rbp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pwn/pwn/rop-2.34+/controlling-rax">Controlling rax</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pwn/pwn/rop-2.34+/dlrop">dlrop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/pwn/pwn/rop-2.34+/other-gadgets">Other gadgets</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pwn/pwn/setcontext">setcontext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pwn/pwn/fork_gadget">fork\_gadget</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pwn/category/ctf-writeups">CTF writeups</a><button aria-label="Expand sidebar category &#x27;CTF writeups&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pwn/category/test">Test</a><button aria-label="Expand sidebar category &#x27;Test&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/pwn/category/pwn"><span>pwn</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/pwn/category/rop-234"><span>ROP 2.34+</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">The problem</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>The problem</h1></header>
<p>Ah the classic overflow challenge. By now most people are familiar with this style of exploit, where you have some buffer on the stack, and you can provide more data than what&#x27;s been allocated for it, leading to a classic overflow. And because it&#x27;s so well known, so are the techniques for it. Take the simple program below.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// gcc demo.c -o demo -no-pie -fno-stack-protector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x20</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">puts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ROP me if you can!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">gets</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>It&#x27;s obvious that we can overflow the <code>buf</code> buffer, so from here we&#x27;d typically use the classic ret2plt attack, where we:</p>
<ul>
<li>Use <code>puts</code> to leak a GOT entry</li>
<li>Return to <code>main</code></li>
<li>Call <code>system(&quot;/bin/sh&quot;)</code></li>
</ul>
<p>First we&#x27;re going to need to find the <code>pop rdi ; ret</code> gadget, so let&#x27;s run <code>ROPgadget</code>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ROPgadget --binary demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Gadgets information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010ab : add bh, bh ; loopne 0x401115 ; nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401037 : add byte ptr [rax], al ; add byte ptr [rax], al ; jmp 0x401020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040115f : add byte ptr [rax], al ; add byte ptr [rax], al ; leave ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401078 : add byte ptr [rax], al ; add byte ptr [rax], al ; nop dword ptr [rax] ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401160 : add byte ptr [rax], al ; add cl, cl ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040111a : add byte ptr [rax], al ; add dword ptr [rbp - 0x3d], ebx ; nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401039 : add byte ptr [rax], al ; jmp 0x401020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401161 : add byte ptr [rax], al ; leave ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040107a : add byte ptr [rax], al ; nop dword ptr [rax] ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401034 : add byte ptr [rax], al ; push 0 ; jmp 0x401020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401044 : add byte ptr [rax], al ; push 1 ; jmp 0x401020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401009 : add byte ptr [rax], al ; test rax, rax ; je 0x401012 ; call rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040111b : add byte ptr [rcx], al ; pop rbp ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401162 : add cl, cl ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010aa : add dil, dil ; loopne 0x401115 ; nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401047 : add dword ptr [rax], eax ; add byte ptr [rax], al ; jmp 0x401020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040111c : add dword ptr [rbp - 0x3d], ebx ; nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401117 : add eax, 0x2f03 ; add dword ptr [rbp - 0x3d], ebx ; nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401118 : add ebp, dword ptr [rdi] ; add byte ptr [rax], al ; add dword ptr [rbp - 0x3d], ebx ; nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401013 : add esp, 8 ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401012 : add rsp, 8 ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010a8 : and byte ptr [rax + 0x40], al ; add bh, bh ; loopne 0x401115 ; nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401010 : call rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401133 : cli ; jmp 0x4010c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401130 : endbr64 ; jmp 0x4010c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040100e : je 0x401012 ; call rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010a5 : je 0x4010b0 ; mov edi, 0x404020 ; jmp rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010e7 : je 0x4010f0 ; mov edi, 0x404020 ; jmp rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040103b : jmp 0x401020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401134 : jmp 0x4010c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010ac : jmp rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401163 : leave ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010ad : loopne 0x401115 ; nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401116 : mov byte ptr [rip + 0x2f03], 1 ; pop rbp ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040115e : mov eax, 0 ; leave ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010a7 : mov edi, 0x404020 ; jmp rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010af : nop ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040112c : nop dword ptr [rax] ; endbr64 ; jmp 0x4010c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040107c : nop dword ptr [rax] ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010a6 : or dword ptr [rdi + 0x404020], edi ; jmp rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040111d : pop rbp ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401036 : push 0 ; jmp 0x401020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401046 : push 1 ; jmp 0x401020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401016 : ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401042 : ret 0x2f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401022 : retf 0x2f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040100d : sal byte ptr [rdx + rax - 1], 0xd0 ; add rsp, 8 ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401169 : sub esp, 8 ; add rsp, 8 ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401168 : sub rsp, 8 ; add rsp, 8 ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040100c : test eax, eax ; je 0x401012 ; call rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010a3 : test eax, eax ; je 0x4010b0 ; mov edi, 0x404020 ; jmp rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010e5 : test eax, eax ; je 0x4010f0 ; mov edi, 0x404020 ; jmp rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x000000000040100b : test rax, rax ; je 0x401012 ; call rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unique gadgets found: 53</span><br></span></code></pre></div></div>
<p>Wait a second. Where&#x27;s <code>pop rdi ; ret</code>? It should be here somewhere right??? Well actually a lot of gadgets here are missing such as:</p>
<ul>
<li><code>pop rdi ; ret</code></li>
<li><code>pop rsi ; pop r15 ; ret</code></li>
<li><code>pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</code></li>
</ul>
<p>So what&#x27;s going on? Let&#x27;s investigate, shall we?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-does-pop-rdi--ret-come-from">Where does <code>pop rdi ; ret</code> come from?<a href="#where-does-pop-rdi--ret-come-from" class="hash-link" aria-label="Direct link to where-does-pop-rdi--ret-come-from" title="Direct link to where-does-pop-rdi--ret-come-from">​</a></h2>
<p>Where did it come from, and where did it go? <del>Where did it come from cotton eye joe?</del></p>
<p>To find this out, let&#x27;s take a binary which has this gadget (which hasn&#x27;t been stripped). There&#x27;s plenty to choose from from countless CTFs, so I chose hackthebox&#x27;s <code>ropme</code>. Running <code>ROPgadget</code>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ROPgadget --binary ropme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Gadgets information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004006d3 : pop rdi ; ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre></div></div>
<p>Let&#x27;s see where this lies in the binary.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pwndbg&gt; x/2i 0x00000000004006d3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x4006d3 &lt;__libc_csu_init+99&gt;:	pop    rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x4006d4 &lt;__libc_csu_init+100&gt;:	ret</span><br></span></code></pre></div></div>
<p>So it seems our beloved gadget belongs to a function called <code>__libc_csu_init</code>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pwndbg&gt; disassemble __libc_csu_init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dump of assembler code for function __libc_csu_init:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400670 &lt;+0&gt;:	push   r15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400672 &lt;+2&gt;:	push   r14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400674 &lt;+4&gt;:	mov    r15d,edi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400677 &lt;+7&gt;:	push   r13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400679 &lt;+9&gt;:	push   r12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x000000000040067b &lt;+11&gt;:	lea    r12,[rip+0x20078e]        # 0x600e10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400682 &lt;+18&gt;:	push   rbp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400683 &lt;+19&gt;:	lea    rbp,[rip+0x20078e]        # 0x600e18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x000000000040068a &lt;+26&gt;:	push   rbx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x000000000040068b &lt;+27&gt;:	mov    r14,rsi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x000000000040068e &lt;+30&gt;:	mov    r13,rdx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400691 &lt;+33&gt;:	sub    rbp,r12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400694 &lt;+36&gt;:	sub    rsp,0x8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000400698 &lt;+40&gt;:	sar    rbp,0x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x000000000040069c &lt;+44&gt;:	call   0x4004b0 &lt;_init&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006a1 &lt;+49&gt;:	test   rbp,rbp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006a4 &lt;+52&gt;:	je     0x4006c6 &lt;__libc_csu_init+86&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006a6 &lt;+54&gt;:	xor    ebx,ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006a8 &lt;+56&gt;:	nop    DWORD PTR [rax+rax*1+0x0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006b0 &lt;+64&gt;:	mov    rdx,r13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006b3 &lt;+67&gt;:	mov    rsi,r14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006b6 &lt;+70&gt;:	mov    edi,r15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006b9 &lt;+73&gt;:	call   QWORD PTR [r12+rbx*8]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006bd &lt;+77&gt;:	add    rbx,0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006c1 &lt;+81&gt;:	cmp    rbx,rbp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006c4 &lt;+84&gt;:	jne    0x4006b0 &lt;__libc_csu_init+64&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006c6 &lt;+86&gt;:	add    rsp,0x8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006ca &lt;+90&gt;:	pop    rbx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006cb &lt;+91&gt;:	pop    rbp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006cc &lt;+92&gt;:	pop    r12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006ce &lt;+94&gt;:	pop    r13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006d0 &lt;+96&gt;:	pop    r14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006d2 &lt;+98&gt;:	pop    r15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004006d4 &lt;+100&gt;:	ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of assembler dump.</span><br></span></code></pre></div></div>
<p>Interestingly the function&#x27;s disassembly doesn&#x27;t seem to contain <code>pop rdi ; ret</code>? That&#x27;s because <code>pop rdi ; ret</code> doesn&#x27;t show up in regular code, but rather comes from splitting an instruction in half, specifically <code>pop r15</code>. You may have noticed that we have <code>__libc_csu_init+98</code> and <code>__libc_csu_init+100</code> in the disassembly, but <code>pop rdi ; ret</code> is at <code>__libc_csu_init+99</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quirk-of-x86">Quirk of x86<a href="#quirk-of-x86" class="hash-link" aria-label="Direct link to Quirk of x86" title="Direct link to Quirk of x86">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pop r15 ; ret = 41 5f c3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   ~~~~~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pop rdi ; ret = 5f c3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ~~~~~</span><br></span></code></pre></div></div>
<p>The above is how these instructions get assembled. You can notice that <code>pop r15 ; ret</code> is longer, but the last 2 bytes are the same as <code>pop rdi ; ret</code> (for some reason). Due to how x86 instructions aren&#x27;t fixed-length like ARM, we can execute an instruction from any point. So, we could take the address of <code>pop r15 ; ret</code>, increment it by 1, and get <code>pop rdi ; ret</code>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pwndbg&gt; x/2i 0x00000000004006d2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x4006d2 &lt;__libc_csu_init+98&gt;:	pop    r15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x4006d4 &lt;__libc_csu_init+100&gt;:	ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pwndbg&gt; x/2i 0x00000000004006d2+1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x4006d3 &lt;__libc_csu_init+99&gt;:	pop    rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x4006d4 &lt;__libc_csu_init+100&gt;:	ret</span><br></span></code></pre></div></div>
<p>So wherever there is a <code>pop r15</code>, there will also be <code>pop rdi</code>. And since <code>__libc_csu_init</code> will always contain <code>pop r15 ; ret</code>, binaries with <code>__libc_csu_init</code> will have <code>pop rdi ; ret</code>!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-did-pop-rdi--ret-go">Where did <code>pop rdi ; ret</code> go?<a href="#where-did-pop-rdi--ret-go" class="hash-link" aria-label="Direct link to where-did-pop-rdi--ret-go" title="Direct link to where-did-pop-rdi--ret-go">​</a></h2>
<p>So if any binary containing <code>__libc_csu_init</code> has the <code>pop rdi</code> gadget, what&#x27;s happening in the demo binary?</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pwndbg&gt; info functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">All defined functions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Non-debugging symbols:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401000  _init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401030  puts@plt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401040  gets@plt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401050  _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401080  _dl_relocate_static_pie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401090  deregister_tm_clones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x00000000004010c0  register_tm_clones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401100  __do_global_dtors_aux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401130  frame_dummy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401136  main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x0000000000401168  _fini</span><br></span></code></pre></div></div>
<p>Aha! In the demo binary, <code>__libc_csu_init</code> is <strong>not</strong> present! But why is that?</p>
<p>Well recently in glibc 2.34, there was a <a href="https://sourceware.org/pipermail/libc-alpha/2021-February/122794.html" target="_blank" rel="noopener noreferrer">patch</a> which stopped <code>__libc_csu_init</code> being compiled into binaries. The patch was designed to remove useful ROP gadgets for <code>ret2csu</code>, and has the effect of removing <code>pop rdi ; ret</code> in binaries compiled against glibc 2.34+.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="side-note-on-__libc_start_main">Side note on <code>__libc_start_main</code><a href="#side-note-on-__libc_start_main" class="hash-link" aria-label="Direct link to side-note-on-__libc_start_main" title="Direct link to side-note-on-__libc_start_main">​</a></h3>
<p>This would change a few things, such as <code>__libc_start_main</code>, which took <code>__libc_csu_init</code> as an argument, expecting it to be run. Now that it doesn&#x27;t exist, it still takes the argument, but does nothing with it, so it had be versioned off for 2.34, as it now had different behaviour. This meant that you couldn&#x27;t run binaries compiled for 2.34+ on older glibc versions, otherwise you&#x27;d get the very annoying error:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34&#x27; not found</span><br></span></code></pre></div></div>
<p>So you have this patch to thank for this :)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sooo-what-now">Sooo what now?<a href="#sooo-what-now" class="hash-link" aria-label="Direct link to Sooo what now?" title="Direct link to Sooo what now?">​</a></h2>
<p>So has this completely killed ROP on modern binaries? Has our time spent practising and mastering the art of ROP all been for nothing, and we&#x27;ll have to move on to other types of exploits entirely?</p>
<p>Woah slow down, I want to argue that it hasn&#x27;t. While it has thrown a wrench in how we do ROP, there are still tricks we can do to get around this, which I will showcase in the following sections.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-sources-of-pop-rdi--ret">Other sources of <code>pop rdi ; ret</code><a href="#other-sources-of-pop-rdi--ret" class="hash-link" aria-label="Direct link to other-sources-of-pop-rdi--ret" title="Direct link to other-sources-of-pop-rdi--ret">​</a></h3>
<p>For one thing, <code>__libc_csu_init</code> isn&#x27;t our only source of <code>pop rdi ; ret</code>. Recall that wherever there&#x27;s <code>pop r15 ; ret</code> there is <code>pop rdi ; ret</code>. But why does <code>pop r15 ; ret</code> show up in <code>__libc_csu_init</code>?</p>
<p>Well normally when we compile, the variables in a function are stored on the stack. But, if we compile using optimization flags (or use <code>register</code> when defining a variable), some variables can be stored in registers instead. The registers typically used include <code>rbp</code>, <code>r12</code>, <code>r13</code>, <code>r14</code>, <code>r15</code>, <code>rbx</code>. For this to work, a function using these registers must push the old values of these registers before using them, and then restore them when returning. This is because other functions may also be using these registers, and so this function could clobber those registers for the other function(s). So, this involves pushing these to the stack at the start, then popping them at the end. If you look back at <code>__libc_csu_init</code>&#x27;s disassembly above, it follows this same pattern, because it&#x27;s compiled with optimization.</p>
<p>This means that if your binary is compiled for optimization, there is a chance <code>r15</code> is used for a variable, meaning it must also be pushed, and more importantly <em>popped</em>, which would result in <code>pop r15</code> -&gt; <code>pop rdi</code>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Unfortunately, from my testing, <code>r15</code> seems to be one of the last ones that gets used, so a function would likely need many register variables for <code>r15</code> to be used.</p></div></div>
<p>This is why glibc will always contain  <code>pop rdi</code>, because it&#x27;s compiled for optimization, and there so many functions with lots of variables stored in registers, so it&#x27;s basically guaranteed that <code>r15</code> is used in at least one of them.</p>
<p>This means that once you have a libc leak, you&#x27;ll always be able to find a <code>pop rdi ; ret</code> gadget. However if all you have is an overflow, and no leak, then this will still cause problems.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>So if your binary doesn&#x27;t have <code>pop rdi ; ret</code>, then you have a few approaches:</p>
<ul>
<li>Get a libc leak using a different bug</li>
<li>Controlling <code>rdi</code> some other way</li>
<li>Use overflow to leak libc</li>
</ul>
<p>In the following sections, I&#x27;ll show some tricks you can use to do the latter 2 approaches :)</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pwn/category/rop-234"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ROP 2.34+</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pwn/pwn/rop-2.34+/ret2gets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ret2gets</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#where-does-pop-rdi--ret-come-from" class="table-of-contents__link toc-highlight">Where does <code>pop rdi ; ret</code> come from?</a><ul><li><a href="#quirk-of-x86" class="table-of-contents__link toc-highlight">Quirk of x86</a></li></ul></li><li><a href="#where-did-pop-rdi--ret-go" class="table-of-contents__link toc-highlight">Where did <code>pop rdi ; ret</code> go?</a><ul><li><a href="#side-note-on-__libc_start_main" class="table-of-contents__link toc-highlight">Side note on <code>__libc_start_main</code></a></li></ul></li><li><a href="#sooo-what-now" class="table-of-contents__link toc-highlight">Sooo what now?</a><ul><li><a href="#other-sources-of-pop-rdi--ret" class="table-of-contents__link toc-highlight">Other sources of <code>pop rdi ; ret</code></a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/pwn/">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>